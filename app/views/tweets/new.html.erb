<div class="new-tweet">
  <h3>æ–°è¦æŠ•ç¨¿</h3>

<%= form_with(model: [@group, @tweet],
              local: true,
              data: { turbo: false },
              html: { id: 'upload-form' }) do |f| %>

    <!-- â˜… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€ï¼ˆã“ã“ã«è¿½åŠ ï¼ï¼‰ -->
  <% if @tweet.errors.any? %>
    <div class="error-messages">
      <ul>
        <% @tweet.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <!-- â˜… ã“ã“ã¾ã§ -->


  <div class="field">
    <%= f.label :ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ %>
    <%= f.text_field :body, size: 140 %>
  </div>

  <!-- â˜… ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆè¤‡æ•°å¯¾å¿œï¼‰ -->
  <div class="field">
    <%= f.file_field :images, multiple: true, 
          id: 'file-upload-input', style: 'display: none;' %>

    <%= f.label :images, "å†™çœŸã‚’è¿½åŠ ",
          class: "add-photo-button",
          for: 'file-upload-input' %>
    <!-- â˜… è¿½åŠ  -->
  <p id="selected-files" class="file-status"></p>
</div>

  <%= f.submit "æŠ•ç¨¿ã™ã‚‹", data: { turbo: false } %>
<% end %>

<%= link_to "ä¸€è¦§ã«æˆ»ã‚‹", group_path(@group) %>

<script>
  document.addEventListener("turbo:load", () => {
    const input = document.getElementById("file-upload-input");
    const status = document.getElementById("selected-files");
    const form = document.getElementById("upload-form");

    if (!input || !status || !form) return;

    input.addEventListener("change", (e) => {
      // â˜… å‹æ‰‹ã« submit ã•ã‚Œã‚‹ã®ã‚’é˜²ã
      e.preventDefault();
      e.stopPropagation();

      if (input.files.length === 0) {
        status.textContent = "";
      } else if (input.files.length === 1) {
        status.textContent = "å†™çœŸã‚’1æšé¸æŠã—ã¾ã—ãŸ";
      } else {
        status.textContent = `å†™çœŸã‚’${input.files.length}æšé¸æŠã—ã¾ã—ãŸ`;
      }
    });

    // å¿µã®ãŸã‚ submit ã‚’ç›£è¦–ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
    form.addEventListener("submit", () => {
      console.log("ğŸš¨ submit fired");
    });
  });
</script>
</div>